2025-01-24T19:02:28.340+01:00  INFO 90451 --- [main] .s.a.m.s.s.s.McpServletServerApplication : Starting McpServletServerApplication v0.0.1-SNAPSHOT using Java 23.0.1 with PID 90451 (/Users/christiantzolov/Dev/projects/spring-ai-examples/model-context-protocol/mcp-servlet-server/target/mcp-servlet-server-0.0.1-SNAPSHOT.jar started by christiantzolov in /Users/christiantzolov/Dev/projects/spring-ai-examples)
2025-01-24T19:02:28.342+01:00  INFO 90451 --- [main] .s.a.m.s.s.s.McpServletServerApplication : No active profile set, falling back to 1 default profile: "default"
2025-01-24T19:02:28.753+01:00  INFO 90451 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-01-24T19:02:28.760+01:00  INFO 90451 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-01-24T19:02:28.760+01:00  INFO 90451 --- [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.33]
2025-01-24T19:02:28.779+01:00  INFO 90451 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-01-24T19:02:28.779+01:00  INFO 90451 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 404 ms
2025-01-24T19:02:29.106+01:00  INFO 90451 --- [pool-1-thread-1] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=initialize, id=d4d5aeb5-0, params={protocolVersion=2024-11-05, capabilities={}, clientInfo={name=Spring AI MCP Client, version=1.0.0}}]
2025-01-24T19:02:29.112+01:00  INFO 90451 --- [pool-1-thread-1] o.s.ai.mcp.server.McpAsyncServer         : Client initialize request - Protocol: 2024-11-05, Capabilities: ClientCapabilities[experimental=null, roots=null, sampling=null], Info: Implementation[name=Spring AI MCP Client, version=1.0.0]
2025-01-24T19:02:29.153+01:00  INFO 90451 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-01-24T19:02:29.161+01:00  INFO 90451 --- [main] .s.a.m.s.s.s.McpServletServerApplication : Started McpServletServerApplication in 1.034 seconds (process running for 1.272)
2025-01-24T19:02:29.163+01:00  INFO 90451 --- [pool-1-thread-1] o.s.ai.mcp.spec.DefaultMcpSession        : Received notification: JSONRPCNotification[jsonrpc=2.0, method=notifications/initialized, params=null]
2025-01-24T19:02:29.164+01:00  INFO 90451 --- [pool-1-thread-1] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=ping, id=d4d5aeb5-1, params=null]
2025-01-24T19:02:29.167+01:00  INFO 90451 --- [pool-1-thread-1] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=tools/list, id=d4d5aeb5-2, params={}]
2025-01-24T19:02:29.177+01:00  INFO 90451 --- [pool-1-thread-1] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=tools/call, id=d4d5aeb5-3, params={name=toUpperCase, arguments={input=accountName}}]
2025-01-24T19:02:29.195+01:00  INFO 90451 --- [pool-1-thread-1] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=tools/call, id=d4d5aeb5-4, params={name=getBooks, arguments={title=Spring Framework}}]
2025-01-24T19:02:30.723+01:00  INFO 90451 --- [pool-1-thread-1] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=resources/list, id=d4d5aeb5-5, params={}]
2025-01-24T19:02:30.730+01:00  INFO 90451 --- [pool-1-thread-1] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=resources/read, id=d4d5aeb5-6, params={uri=system://info}]
2025-01-24T19:02:30.738+01:00  INFO 90451 --- [pool-1-thread-1] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=prompts/list, id=d4d5aeb5-7, params={}]
2025-01-24T19:02:30.744+01:00  INFO 90451 --- [pool-1-thread-1] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=prompts/get, id=d4d5aeb5-8, params={name=greeting, arguments={name=Spring}}]
2025-01-24T19:02:43.319+01:00  INFO 90643 --- [main] .s.a.m.s.s.s.McpServletServerApplication : Starting McpServletServerApplication using Java 17.0.12 with PID 90643 (/Users/christiantzolov/Dev/projects/spring-ai-examples/model-context-protocol/mcp-servlet-server/target/classes started by christiantzolov in /Users/christiantzolov/Dev/projects/spring-ai-examples)
2025-01-24T19:02:43.320+01:00  INFO 90643 --- [main] .s.a.m.s.s.s.McpServletServerApplication : No active profile set, falling back to 1 default profile: "default"
2025-01-24T19:02:43.653+01:00  INFO 90643 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-01-24T19:02:43.658+01:00  INFO 90643 --- [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-01-24T19:02:43.659+01:00  INFO 90643 --- [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.33]
2025-01-24T19:02:43.683+01:00  INFO 90643 --- [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-01-24T19:02:43.683+01:00  INFO 90643 --- [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 345 ms
2025-01-24T19:02:44.003+01:00  INFO 90643 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-01-24T19:02:44.008+01:00  INFO 90643 --- [main] .s.a.m.s.s.s.McpServletServerApplication : Started McpServletServerApplication in 0.862 seconds (process running for 0.983)
2025-01-24T19:02:47.492+01:00  INFO 90643 --- [http-nio-8080-exec-2] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=initialize, id=7b98b98f-0, params={protocolVersion=2024-11-05, capabilities={}, clientInfo={name=Spring AI MCP Client, version=1.0.0}}]
2025-01-24T19:02:47.496+01:00  INFO 90643 --- [http-nio-8080-exec-2] o.s.ai.mcp.server.McpAsyncServer         : Client initialize request - Protocol: 2024-11-05, Capabilities: ClientCapabilities[experimental=null, roots=null, sampling=null], Info: Implementation[name=Spring AI MCP Client, version=1.0.0]
2025-01-24T19:02:47.541+01:00  INFO 90643 --- [http-nio-8080-exec-3] o.s.ai.mcp.spec.DefaultMcpSession        : Received notification: JSONRPCNotification[jsonrpc=2.0, method=notifications/initialized, params=null]
2025-01-24T19:02:47.544+01:00  INFO 90643 --- [http-nio-8080-exec-4] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=ping, id=7b98b98f-1, params=null]
2025-01-24T19:02:47.547+01:00  INFO 90643 --- [http-nio-8080-exec-5] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=tools/list, id=7b98b98f-2, params={}]
2025-01-24T19:02:47.557+01:00  INFO 90643 --- [http-nio-8080-exec-6] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=tools/call, id=7b98b98f-3, params={name=toUpperCase, arguments={input=accountName}}]
2025-01-24T19:02:47.579+01:00  INFO 90643 --- [http-nio-8080-exec-7] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=tools/call, id=7b98b98f-4, params={name=getBooks, arguments={title=Spring Framework}}]
2025-01-24T19:02:49.611+01:00  INFO 90643 --- [http-nio-8080-exec-8] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=resources/list, id=7b98b98f-5, params={}]
2025-01-24T19:02:49.621+01:00  INFO 90643 --- [http-nio-8080-exec-9] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=resources/read, id=7b98b98f-6, params={uri=system://info}]
2025-01-24T19:02:49.630+01:00  INFO 90643 --- [http-nio-8080-exec-10] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=prompts/list, id=7b98b98f-7, params={}]
2025-01-24T19:02:49.637+01:00  INFO 90643 --- [http-nio-8080-exec-1] o.s.ai.mcp.spec.DefaultMcpSession        : Received request: JSONRPCRequest[jsonrpc=2.0, method=prompts/get, id=7b98b98f-8, params={name=greeting, arguments={name=Spring}}]
2025-01-24T19:02:52.594+01:00 ERROR 90643 --- [SpringApplicationShutdownHook] reactor.core.publisher.Operators         : Operator called default onErrorDropped

reactor.core.Exceptions$ErrorCallbackNotImplemented: java.lang.IllegalStateException: The request associated with the AsyncContext has already completed processing.
Caused by: java.lang.IllegalStateException: The request associated with the AsyncContext has already completed processing.
	at org.apache.catalina.core.AsyncContextImpl.check(AsyncContextImpl.java:529) ~[tomcat-embed-core-10.1.33.jar:10.1.33]
	at org.apache.catalina.core.AsyncContextImpl.complete(AsyncContextImpl.java:92) ~[tomcat-embed-core-10.1.33.jar:10.1.33]
	at org.springframework.ai.mcp.server.transport.HttpServletSseServerTransport.removeSession(HttpServletSseServerTransport.java:392) ~[mcp-0.6.0.jar:0.6.0]
	at java.base/java.util.concurrent.ConcurrentHashMap$ValuesView.forEach(ConcurrentHashMap.java:4780) ~[na:na]
	at org.springframework.ai.mcp.server.transport.HttpServletSseServerTransport.lambda$closeGracefully$4(HttpServletSseServerTransport.java:364) ~[mcp-0.6.0.jar:0.6.0]
	at reactor.core.publisher.MonoCreate.subscribe(MonoCreate.java:61) ~[reactor-core-3.6.12.jar:3.6.12]
	at reactor.core.publisher.Mono.subscribe(Mono.java:4576) ~[reactor-core-3.6.12.jar:3.6.12]
	at reactor.core.publisher.Mono.subscribeWith(Mono.java:4642) ~[reactor-core-3.6.12.jar:3.6.12]
	at reactor.core.publisher.Mono.subscribe(Mono.java:4403) ~[reactor-core-3.6.12.jar:3.6.12]
	at org.springframework.ai.mcp.spec.McpTransport.close(McpTransport.java:74) ~[mcp-0.6.0.jar:0.6.0]
	at org.springframework.ai.mcp.server.transport.HttpServletSseServerTransport.close(HttpServletSseServerTransport.java:336) ~[mcp-0.6.0.jar:0.6.0]
	at org.springframework.ai.mcp.spec.DefaultMcpSession.close(DefaultMcpSession.java:296) ~[mcp-0.6.0.jar:0.6.0]
	at org.springframework.ai.mcp.server.McpAsyncServer.close(McpAsyncServer.java:396) ~[mcp-0.6.0.jar:0.6.0]
	at org.springframework.ai.mcp.server.McpSyncServer.close(McpSyncServer.java:250) ~[mcp-0.6.0.jar:0.6.0]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
	at org.springframework.beans.factory.support.DisposableBeanAdapter.invokeCustomDestroyMethod(DisposableBeanAdapter.java:316) ~[spring-beans-6.1.15.jar:6.1.15]
	at org.springframework.beans.factory.support.DisposableBeanAdapter.destroy(DisposableBeanAdapter.java:249) ~[spring-beans-6.1.15.jar:6.1.15]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroyBean(DefaultSingletonBeanRegistry.java:587) ~[spring-beans-6.1.15.jar:6.1.15]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroySingleton(DefaultSingletonBeanRegistry.java:559) ~[spring-beans-6.1.15.jar:6.1.15]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.destroySingleton(DefaultListableBeanFactory.java:1202) ~[spring-beans-6.1.15.jar:6.1.15]
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroySingletons(DefaultSingletonBeanRegistry.java:520) ~[spring-beans-6.1.15.jar:6.1.15]
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.destroySingletons(DefaultListableBeanFactory.java:1195) ~[spring-beans-6.1.15.jar:6.1.15]
	at org.springframework.context.support.AbstractApplicationContext.destroyBeans(AbstractApplicationContext.java:1195) ~[spring-context-6.1.15.jar:6.1.15]
	at org.springframework.context.support.AbstractApplicationContext.doClose(AbstractApplicationContext.java:1156) ~[spring-context-6.1.15.jar:6.1.15]
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.doClose(ServletWebServerApplicationContext.java:174) ~[spring-boot-3.3.6.jar:3.3.6]
	at org.springframework.context.support.AbstractApplicationContext.close(AbstractApplicationContext.java:1102) ~[spring-context-6.1.15.jar:6.1.15]
	at org.springframework.boot.SpringApplicationShutdownHook.closeAndWait(SpringApplicationShutdownHook.java:145) ~[spring-boot-3.3.6.jar:3.3.6]
	at java.base/java.lang.Iterable.forEach(Iterable.java:75) ~[na:na]
	at org.springframework.boot.SpringApplicationShutdownHook.run(SpringApplicationShutdownHook.java:114) ~[spring-boot-3.3.6.jar:3.3.6]
	at java.base/java.lang.Thread.run(Thread.java:842) ~[na:na]

